@echo off
REM ============================================================================
REM Защита видео от распознавания - Программа v2.1
REM Это приложение добавляет невидимый шум в видео для защиты от нейросетей
REM ============================================================================

chcp 65001 >nul
setlocal enabledelayedexpansion

cls
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo    🎬  ЗАЩИТА ВИДЕО ОТ РАСПОЗНАВАНИЯ (v2.1)
echo ════════════════════════════════════════════════════════════════════════════
echo.
echo  Эта программа добавляет "невидимый" шум в видео для защиты от:
echo    • Компьютерного зрения (CV-моделей)
echo    • Нейросетей, распознающих лица
echo    • Нежелательного анализа видео
echo.
echo  Шум практически невидим для человека, но сильно запутывает нейросети.
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo.

REM Проверяем Python
where python >nul 2>nul
if errorlevel 1 (
    echo ❌ ОШИБКА: Python не найден!
    echo.
    echo Решение:
    echo   1. Установите Python 3.8+ с сайта python.org
    echo   2. При установке выберите "Add Python to PATH"
    echo   3. Перезагрузите компьютер
    echo   4. Запустите этот файл снова
    echo.
    pause
    exit /b 1
)

REM Проверяем виртуальное окружение
if not exist ".venv\Scripts\python.exe" (
    echo ❌ ОШИБКА: Виртуальное окружение не найдено!
    echo.
    echo Решение:
    echo   1. Откройте PowerShell в этой папке
    echo   2. Выполните: python -m venv .venv
    echo   3. Выполните: .venv\Scripts\pip install -r requirements.txt
    echo   4. Запустите run.bat снова
    echo.
    pause
    exit /b 1
)

REM Меню выбора
:menu
cls
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo    🎬  ЗАЩИТА ВИДЕО (v2.1)
echo ════════════════════════════════════════════════════════════════════════════
echo.
echo  Выберите действие:
echo.
echo    1️⃣  Обработать видео (основное действие)
echo    2️⃣  Проверить что всё работает
echo    3️⃣  Посмотреть документацию
echo    4️⃣  Выход
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo.

set /p choice="Выберите (1-4): "

if "%choice%"=="1" goto run_main
if "%choice%"=="2" goto run_validation
if "%choice%"=="3" goto show_docs
if "%choice%"=="4" exit /b 0

echo ❌ Неправильный выбор! Попробуйте снова.
timeout /t 2 >nul
goto menu

REM ============================================================================
REM Основная программа
REM ============================================================================
:run_main
cls
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo    🚀 ЗАПУСК ПРОГРАММЫ ЗАЩИТЫ ВИДЕО
echo ════════════════════════════════════════════════════════════════════════════
echo.
echo  ⏳ Загрузка программы...
echo.

".venv\Scripts\python.exe" media_cleaner.py

if errorlevel 1 (
    echo.
    echo ❌ ОШИБКА при выполнении программы!
    echo.
    pause
)

goto menu

REM ============================================================================
REM Проверка что всё работает
REM ============================================================================
:run_validation
cls
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo    ✅ ПРОВЕРКА СИСТЕМЫ
echo ════════════════════════════════════════════════════════════════════════════
echo.
echo  ⏳ Проверяем конфигурацию...
echo.

".venv\Scripts\python.exe" validate_v2_1.py

if errorlevel 1 (
    echo.
    echo ❌ Система не готова!
    echo.
) else (
    echo.
    echo ✅ Система готова к работе!
    echo.
)

pause
goto menu

REM ============================================================================
REM Документация
REM ============================================================================
:show_docs
cls
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo    📚 ДОКУМЕНТАЦИЯ
echo ════════════════════════════════════════════════════════════════════════════
echo.
echo  Доступные документы:
echo.
echo    📄 README_v2_1_RELEASE.txt    - Описание программы (начните отсюда)
echo    📄 QUICKSTART_v2.1.md         - Быстрый старт за 5 минут
echo    📄 CHECKLIST_v2.1.md          - Пошаговое руководство
echo    📄 OPTIMIZATION_NOTES_v2.1.md - Как это работает
echo.
echo  Откройте в текстовом редакторе: Блокнот, VS Code, Notepad++
echo.
echo  Быстро проверить результаты:
echo    • Посмотрите файл: IMG_9864_protected.mp4 (после обработки)
echo    • Откройте в медиаплеере (VLC, Windows Media Player)
echo.
pause
goto menu

REM ============================================================================
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo    Программа завершена
echo ════════════════════════════════════════════════════════════════════════════
echo.
pause
exit /b 0
