═══════════════════════════════════════════════════════════════════════════════
ЧЕК-ЛИСТ ПЕРЕД РАЗВЕРТЫВАНИЕМ НА ВЫДЕЛЁННОМ СЕРВЕРЕ
═══════════════════════════════════════════════════════════════════════════════

РАЗДЕЛ 1: ПОДГОТОВКА ДОМЕНА И DNS
─────────────────────────────────────────────────────────────────────────────

☐ У вас есть доменное имя (например: video-cleaner.example.com)?
☐ Домен зарегистрирован и активен?
☐ У вас есть доступ к панели управления DNS?
☐ DNS A запись указывает на IP вашего сервера?
      Команда для проверки: nslookup video-cleaner.example.com
      Ожидаемый результат: IP сервера
☐ Дайте DNS 15-30 минут чтобы распространиться
☐ Проверьте что домен разрешается: ping video-cleaner.example.com


РАЗДЕЛ 2: ТРЕБОВАНИЯ К СЕРВЕРУ (Linux/Ubuntu)
─────────────────────────────────────────────────────────────────────────────

ПРОЦЕССОР (CPU):
☐ Минимум: 2 CPU cores
☐ Рекомендуется: 4+ CPU cores для обработки видео
☐ Проверка: nproc (должно вывести кол-во потоков)

ПАМЯТЬ (RAM):
☐ Минимум: 4 GB RAM
☐ Рекомендуется: 8-16 GB RAM (для обработки видео)
☐ Если GPU: 32 GB RAM для хорошей производительности
☐ Проверка: free -h (смотрите "Mem:" строку)

ДИСК (SSD):
☐ Минимум: 50 GB свободного места
☐ Рекомендуется: 100+ GB
☐ Предпочтительно: SSD для быстрого доступа
☐ Проверка: df -h (смотрите доступное место в /)

ОПЕРАЦИОННАЯ СИСТЕМА:
☐ Ubuntu 20.04 LTS или новее
☐ Или: Debian 11+
☐ Или: CentOS 8+ (процесс установки немного отличается)
☐ Проверка: lsb_release -a

СЕТЕВОЕ СОЕДИНЕНИЕ:
☐ Стабильное подключение к интернету
☐ Минимум: 10 Mbps upload speed
☐ Рекомендуется: 100+ Mbps для быстрой загрузки видео
☐ Проверка: speedtest-cli (если установлено)

ДОСТУП К СЕРВЕРУ:
☐ SSH доступ с правами root или sudo
☐ Получи SSH ключ или пароль от хостера
☐ Проверь что можешь подключиться:
     ssh root@YOUR_SERVER_IP
     или
     ssh ubuntu@YOUR_SERVER_IP


РАЗДЕЛ 3: ВЫБОР ХОСТЕРА И VPS ПАРАМЕТРЫ
─────────────────────────────────────────────────────────────────────────────

РЕКОМЕНДУЕМЫЕ ХОСТЕРЫ:
• DigitalOcean (доп. опция: GPU Droplet)
• Linode (возможен GPU)
• Vultr (доступны GPU машины)
• AWS EC2 (можно взять GPU instance)
• Azure Virtual Machines
• Google Cloud VM

МИНИМАЛЬНАЯ КОНФИГУРАЦИЯ:
• 2 vCPU
• 8 GB RAM
• 50 GB SSD диск
• Бандвидт: ~1000 GB/месяц заливный

РЕКОМЕНДУЕМАЯ КОНФИГУРАЦИЯ:
• 4 vCPU
• 16 GB RAM
• 100 GB SSD диск
• Бандвидт: ~2000+ GB/месяц

С GPU (ОПЦИОНАЛЬНО):
• 4+ vCPU
• 32 GB RAM
• 100+ GB SSD
• 1x NVIDIA GPU (T4 или лучше)
• Значительно ускорит видео-обработку

ОРИЕНТИРОВОЧНАЯ СТОИМОСТЬ (в месяц):
• Минимальная конфигурация: $5-10 USD
• Рекомендуемая конфигурация: $20-30 USD
• С GPU: $100-300+ USD (зависит от GPU)

РЕКОМЕНДАЦИЯ ИСПОЛЬЗУЮЩИХ:
☐ Используйте вычисляемую по требованиям вашего количества одновременных пользователей
☐ Начните с минимальной, потом масштабируйте если необходимо
☐ Убедитесь что хостер позволяет масштабировать


РАЗДЕЛ 4: ПОДГОТОВКА К УСТАНОВКЕ
─────────────────────────────────────────────────────────────────────────────

ПЕРЕД УСТАНОВКОЙ:
☐ Файлы проекта готовы к загрузке на сервер:
     • media_cleaner.py
     • server_app.py (FastAPI)
     • main.py (Flask)
     • queue_processor.py
     • requirements.txt
     • config.json
     • static/ папка (со всеми CSS/JS файлами)
     • templates/ папка (с index.html)
     ☐ Все файлы находятся в одной папке

☐ Git репозиторий готов (или будете загружать по SFTP)

☐ Email для Let's Encrypt SSL сертификата (например: admin@example.com)

☐ Заранее запишите:
     • IP адрес сервера: ________________
     • SSH логин: ________________
     • SSH пароль или ключ: ________________
     • Домен: ________________
     • Email для SSL: ________________

☐ Терминал доступен (PuTTY, MobaXterm, или встроенный SSH в Linux/Mac)


РАЗДЕЛ 5: ТРЕБОВАНИЯ К ФАЙЛАМ ПРОЕКТА
─────────────────────────────────────────────────────────────────────────────

ОБЯЗАТЕЛЬНЫЕ ФАЙЛЫ:
☐ media_cleaner.py (основной видео-процессор)
☐ server_app.py (FastAPI приложение)
☐ main.py (Flask веб-интерфейс)
☐ queue_processor.py (очередь задач)
☐ requirements.txt (зависимости Python)
☐ config.json (конфигурация, ОБНОВИТЬ ПУТИ!)
☐ templates/index.html (веб-интерфейс)
☐ static/script.js (JavaScript интерфейс)
☐ static/style.css (стили)

ОПЦИОНАЛЬНЫЕ:
☐ ffmpeg/ папка (если хотите бинарник на сервере)
☐ .gitignore (если используете git)
☐ README.md (документация)

☐ Убедитесь что config.json обновлён для Linux:
     Измените путь к ffmpeg:
     "path": "/usr/bin/ffmpeg"    (вместо C:\users\...)

☐ Проверьте что в config.json нет Windows-специфичных путей


РАЗДЕЛ 6: ТРЕБОВАНИЯ К СЕТЕВОЙ БЕЗОПАСНОСТИ
─────────────────────────────────────────────────────────────────────────────

ПОРТЫ КОТОРЫЕ ДОЛЖНЫ БЫТЬ ОТКРЫТЫ:
☐ 22/TCP (SSH - для администрирования)
☐ 80/TCP (HTTP - редирект на HTTPS)
☐ 443/TCP (HTTPS - основной доступ)

ПОРТЫ КОТОРЫЕ ДОЛЖНЫ БЫТЬ ЗАКРЫТЫ:
☐ 5000 (Flask) - открыт только для Nginx (127.0.0.1)
☐ 8000 (FastAPI) - открыт только для Nginx (127.0.0.1)
☐ Все остальные порты закрыты файрволом

ФАЙРВОЛ (UFW):
☐ Файрвол включен
☐ Правила добавлены:
     sudo ufw allow 22/tcp
     sudo ufw allow 80/tcp
     sudo ufw allow 443/tcp
☐ Остальное заблокировано по умолчанию

IPTABLES (если нужно):
☐ Проверить текущие правила: sudo iptables -L
☐ Соответствуют ли вышеперечисленным?


РАЗДЕЛ 7: ТРЕБОВАНИЯ К БЭКАП И ВОССТАНОВЛЕНИЮ
─────────────────────────────────────────────────────────────────────────────

☐ Определитесь с стратегией бэкап:
   ☐ Ежедневный бэкап конфига
   ☐ Еженедельный бэкап всего приложения
   ☐ Месячный бэкап базы данных (если есть)

☐ Выберите место хранения бэкапов:
   ☐ На сервере в /home/media_cleaner/backups/
   ☐ На облачном хранилище (AWS S3, Google Cloud Storage, и т.д.)
   ☐ На локальной машине (через rsync или scp)

☐ Создите план восстановления:
   ☐ Документируйте как восстановиться из бэкап
   ☐ Тестируйте восстановление регулярно


РАЗДЕЛ 8: ТРЕБОВАНИЯ К МОНИТОРИНГУ И ЛОГАМ
─────────────────────────────────────────────────────────────────────────────

☐ Готово ко включению мониторинга:
   ☐ htop или другой системный монитор установлен
   ☐ Знаете как просматривать логи journalctl
   ☐ Знаете как просматривать логи Nginx

☐ Логирование настроено:
   ☐ API логилет в journalctl
   ☐ Web логирует через Gunicorn
   ☐ Nginx логи в /var/log/nginx/

☐ Ротация логов:
   ☐ Старые логи автоматически архивируются
   ☐ Дисковое пространство не забивается


РАЗДЕЛ 9: ТРЕБОВАНИЯ К SSL/TLS
─────────────────────────────────────────────────────────────────────────────

SSL СЕРТИФИКАТ:
☐ Let's Encrypt работает бесплатно
☐ Certbot автоматически обновляет сертификат
☐ Выберите правильный Email для Let's Encrypt
☐ Убедитесь что домен разрешается ДО запуска certbot

ПРОВЕРКА СЕРТИФИКАТА:
☐ После установки проверьте: https://your-domain.com
☐ Браузер должен показать зелёный замок (HTTPS)
☐ Без предупреждений о безопасности


РАЗДЕЛ 10: ТРЕБОВАНИЯ К PYTHON ОКРУЖЕНИЮ
─────────────────────────────────────────────────────────────────────────────

PYTHON ВЕРСИЯ:
☐ Python 3.8+ (будет установлена версия 3.11)
☐ Проверка на сервере: python3 --version

PIP И ЗАВИСИМОСТИ:
☐ Все зависимости из requirements.txt установлены
☐ PyTorch установлен (может взять долгое время!)
☐ FFmpeg установлен и доступен

ВИРТУАЛЬНОЕ ОКРУЖЕНИЕ:
☐ Создано в /home/media_cleaner/venv
☐ Активируется перед запуском команд
☐ Использует Python 3.11 по умолчанию

GPU ПОДДЕРЖКА (опционально):
☐ Если есть NVIDIA GPU:
   ☐ CUDA Toolkit 11.8+ установлен
   ☐ cuDNN установлен
   ☐ PyTorch скомпилирован с CUDA поддержкой


РАЗДЕЛ 11: ТРЕБОВАНИЯ К ПРОИЗВОДСТВЕННОЙ ГОТОВНОСТИ
─────────────────────────────────────────────────────────────────────────────

ПЕРЕД ЗАПУСКОМ:
☐ Тестирование локально (у себя) завершено
☐ Нет синтаксических ошибок в Python
☐ Нет ошибок при запуске обоих серверов
☐ Тест загрузки видео пройден
☐ Тест обработки видео пройден
☐ Нет утечек памяти (проверена функцией Memory Leak Fix)

SECURITY:
☐ Пароли изменены на сильные
☐ SSH ключ установлен (вместо пароля)
☐ Файрвол включен и настроен
☐ Отключена аутентификация по паролю для SSH
☐ Только root/sudo пользователи имеют доступ

МАСШТАБИРУЕМОСТЬ:
☐ Nginx правильно конфигурирован
☐ Gunicorn использует 4+ workers
☐ Uvicorn использует 4+ workers
☐ Config.json настроен под серверные ресурсы

РЕЗЕРВИРОВАНИЕ:
☐ Cron job для ежедневного бэкап установлен
☐ Есть стратегия восстановления
☐ Бэкап места протестирован


РАЗДЕЛ 12: КОНТРОЛЬНЫЙ СПИСОК УСТАНОВКИ
─────────────────────────────────────────────────────────────────────────────

ЭТАП УСТАНОВКИ:
☐ Система обновлена (apt update && apt upgrade)
☐ Python 3.11 установлен
☐ FFmpeg установлен
☐ Nginx установлен
☐ Certbot установлен
☐ Виртуальное окружение создано
☐ requirements.txt установлен
☐ Пользователь media_cleaner создан
☐ Папки uploads/logs/temp созданы

SYSTEMD СЕРВИСЫ:
☐ media-cleaner-api.service создан
☐ media-cleaner-web.service создан
☐ Оба сервиса включены (enable)
☐ Оба сервиса запущены (start)
☐ Оба сервиса активны

NGINX:
☐ Конфиг /etc/nginx/sites-available/media-cleaner создан
☐ Символическая ссылка в sites-enabled создана
☐ Тест конфига пройден (nginx -t)
☐ Nginx перезагружен
☐ Nginx активен

SSL СЕРТИФИКАТ:
☐ Certbot получил сертификат
☐ Сертификат в /etc/letsencrypt/live/domain
☐ HTTPS работает (443 порт открыт)
☐ HTTP редирект на HTTPS работает

ТЕСТИРОВАНИЕ:
☐ https://your-domain.com доступен в браузере
☐ Веб-интерфейс загружается
☐ API документация доступна
☐ Загрузка видео возможна
☐ Обработка видео начинается
☐ Логи отображаются в реал-тайме
☐ Нет ошибок в браузер консоли
☐ Нет утечек памяти


═══════════════════════════════════════════════════════════════════════════════
ЕСЛИ ЧТО-ТО НЕ ПОЛУЧИЛОСЬ
═══════════════════════════════════════════════════════════════════════════════

❌ Ошибка при установке Python:
   → Используйте ubuntu:20.04 образ (более стабильный)
   → Или установите Python 3.9 вместо 3.11

❌ PyTorch не устанавливается:
   → Может занять 5-10 минут (зависит от сети)
   → Убедитесь что у вас 8+ GB RAM
   → Проверьте что диск не заполнен (df -h)

❌ FFmpeg не найден:
   → apt install ffmpeg или из источников
   → Проверьте что /usr/bin/ffmpeg существует

❌ Nginx говорит "port 80 already in use":
   → Уже есть другой веб-сервер (Apache, Nginx)
   → sudo systemctl stop apache2
   → Или используйте другой порт

❌ SSL сертификат не устанавливается:
   → DNS запись должна быть активна
   → Домен должен разрешаться правильно
   → Дайте 15-30 минут чтобы DNS распространился

❌ 502 Bad Gateway в Nginx:
   → Проверьте что API запущен: sudo systemctl status media-cleaner-api
   → Посмотрите логи: sudo journalctl -u media-cleaner-api -n 50

❌ Высокое использование памяти:
   → Уменьшите количество workers
   → Или добавьте more RAM
   → Или используйте GPU для обработки

❌ Файлы не могут быть загружены (Permission Denied):
   → sudo chown -R media_cleaner:media_cleaner /home/media_cleaner/uploads
   → sudo chmod 755 /home/media_cleaner/uploads


═══════════════════════════════════════════════════════════════════════════════
ПОСЛЕ УСПЕШНОГО РАЗВЕРТЫВАНИЯ
═══════════════════════════════════════════════════════════════════════════════

✅ ПОЗДРАВЛЯЕМ! Ваше приложение работает!

Теперь:
• Загрузите первое тестовое видео
• Убедитесь что обработка работает
• Проверьте логи на ошибки
• Установите мониторинг
• Создайте бэкап системы
• Настройте автозапуск сервисов
• Задокументируйте вашу конфигурацию

═══════════════════════════════════════════════════════════════════════════════
