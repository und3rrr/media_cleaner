# 🌐 WEB INTERFACE GUIDE - Полное руководство

## Быстрый старт

### На Windows
```bash
run_full_server.bat
```

### На Linux/Debian
```bash
chmod +x run_full_server.sh
./run_full_server.sh
```

Откройте в браузере: **http://127.0.0.1:5000**

---

## 📋 Архитектура

### Компоненты системы

```
┌─────────────────────────────────────────────────────────────┐
│                   БРАУЗЕР ПОЛЬЗОВАТЕЛЯ                       │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │         Веб интерфейс (HTML/CSS/JavaScript)        │   │
│  │                                                      │   │
│  │  • Загрузка видео (Drag-n-Drop)                     │   │
│  │  • Параметры обработки (Sliders)                    │   │
│  │  • Статус в реальном времени                        │   │
│  │  • Логи обработки (Консоль)                         │   │
│  │  • Скачивание видео                                 │   │
│  └──────────────────────────────────────────────────────┘   │
│                            ↕                                  │
│                      HTTP/AJAX                               │
│                            ↕                                  │
├─────────────────────────────────────────────────────────────┤
│                     Flask Веб-сервер                         │
│                  (web_interface.py)                          │
├─────────────────────────────────────────────────────────────┤
│  Порт 5000                                                   │
│                                                               │
│  Маршруты:                                                   │
│  • GET  /              → index.html                          │
│  • POST /upload        → Загрузка видео на API               │
│  • GET  /api/task/<id> → Статус задачи                       │
│  • POST /api/download/<id> → Скачивание видео               │
│  • POST /api/cancel/<id>   → Отмена обработки               │
│  • GET  /api/stats         → Статистика                      │
│  • GET  /api/health        → Проверка здоровья              │
│                                                               │
└─────────────────────────────────────────────────────────────┘
                            ↕
                      HTTP/REST API
                            ↕
┌─────────────────────────────────────────────────────────────┐
│                     FastAPI сервер                           │
│                    (server_app.py)                           │
├─────────────────────────────────────────────────────────────┤
│  Порт 8000                                                   │
│                                                               │
│  • Управление задачами                                       │
│  • Очередь обработки                                         │
│  • Фоновые рабочие потоки                                    │
│                                                               │
└─────────────────────────────────────────────────────────────┘
                            ↕
                    Media Cleaner Core
                    (media_cleaner.py)
                       
                    Видео обработка:
                    • Генерация возмущений
                    • Наложение на видео
                    • Защита аудиотрека
                    • Сохранение результата
```

---

## 🎨 Интерфейс пользователя

### Главная страница (index.html)

```
┌─────────────────────────────────────────────────────────────┐
│  ЗАГОЛОВОК                                                  │
│  Media Cleaner | 🟢 Сервер online                           │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ЛЕВАЯ КОЛОНКА          │      ПРАВАЯ КОЛОНКА              │
│  ─────────────────────  │      ──────────────────           │
│                         │                                    │
│  Загрузка видео         │      Статус обработки            │
│  ┌───────────────────┐  │      ┌──────────────────────┐    │
│  │ Перетащите видео  │  │      │ ⏳ ОЖИДАНИЕ           │    │
│  │                   │  │      │ ████████░░░░░░░░ 50% │    │
│  └───────────────────┘  │      │ Обрабатывается...    │    │
│                         │      │ [Отменить]           │    │
│  Параметры обработки    │      │                      │    │
│  ┌───────────────────┐  │      │                      │    │
│  │ Epsilon: ————○─── │  │      │ Логи обработки       │    │
│  │ Audio: [Слабый▼]  │  │      │ ┌──────────────────┐ │    │
│  │ Frames: ─────●─── │  │      │ │[12:34:56] ✨ ...│ │    │
│  │ Strength: ───○─── │  │      │ │[12:34:57] ⚙️ ... │ │    │
│  │ Имя: [________]   │  │      │ │[12:34:58] ✅ ... │ │    │
│  │                   │  │      │ │[12:34:59] 📊 ... │ │    │
│  │ [🚀 Начать]       │  │      │ └──────────────────┘ │    │
│  └───────────────────┘  │      └──────────────────────┘    │
│                         │                                    │
└─────────────────────────────────────────────────────────────┘
ПОДВАЛ: © 2024 Media Cleaner
```

---

## 📁 Файлы веб-интерфейса

### web_interface.py (3.5 KB)
Flask приложение с REST API для взаимодействия с Media Cleaner сервером.

**Основные функции:**
```python
# Загрузка видео и отправка на API сервер
@app.route('/upload', methods=['POST'])
def upload_video()

# Получить статус задачи
@app.route('/api/task/<task_id>')
def get_task_status(task_id)

# Скачать готовое видео
@app.route('/api/download/<task_id>')
def download_video(task_id)

# Отменить обработку
@app.route('/api/cancel/<task_id>', methods=['POST'])
def cancel_task(task_id)

# Статистика и здоровье
@app.route('/api/stats')
@app.route('/api/health')
```

### templates/index.html (7.5 KB)
Главная HTML страница с структурой интерфейса.

**Секции:**
- Заголовок с логотипом и статусом сервера
- Левая колонка: загрузка видео, параметры
- Правая колонка: статус, консоль логов
- Подвал

### static/style.css (12 KB)
Полная стилизация интерфейса.

**Темы:**
- Темная тема с градиентами (Indigo/Blue)
- Адаптивный дизайн (Desktop, Tablet, Mobile)
- Анимации и переходы
- Скроллбары в стиле темы

**Переменные цветов:**
```css
--primary: #6366f1        /* Indigo */
--success: #10b981        /* Green */
--danger: #ef4444         /* Red */
--warning: #f59e0b        /* Amber */
```

### static/script.js (9 KB)
JavaScript логика для интерфейса.

**Основной функционал:**
- Выбор файла (click, drag-drop)
- Синхронизация слайдеров
- Загрузка видео с прогрессом
- Опросы статуса каждые 2 сек
- Обновление консоли логов
- Скачивание готового видео
- Проверка здоровья сервера

---

## 🚀 Запуск

### Способ 1: Оба в одном процессе (простейший)

**Windows:**
```bash
run_full_server.bat
```

**Linux:**
```bash
chmod +x run_full_server.sh
./run_full_server.sh
```

### Способ 2: Раздельный запуск (продакшн)

**Терминал 1 - API сервер:**
```bash
python run_server.py
# Слушает на http://127.0.0.1:8000
```

**Терминал 2 - Веб интерфейс:**
```bash
python web_interface.py
# Слушает на http://127.0.0.1:5000
```

### Способ 3: Production с Gunicorn

**Веб интерфейс:**
```bash
gunicorn --bind 0.0.0.0:5000 --workers 4 web_interface:app
```

**API сервер:**
```bash
gunicorn --bind 0.0.0.0:8000 --workers 4 --worker-class uvicorn.workers.UvicornWorker server_app:app
```

---

## 🔧 Конфигурация

### Переменные окружения

```bash
# Указать адрес API сервера
export API_SERVER=http://127.0.0.1:8000

# Запустить веб интерфейс на другом порту
python web_interface.py 3000

# Запустить в режиме отладки
export FLASK_ENV=development
python web_interface.py
```

### server_config.py - Параметры по умолчанию

```python
DEFAULT_EPSILON = 0.12              # Сила возмущения (0.04 - 0.20)
DEFAULT_AUDIO_LEVEL = "слабый"      # Уровень защиты аудио
DEFAULT_EVERY_N_FRAMES = 10          # Обрабатывать каждый N-й кадр
DEFAULT_VIDEO_STRENGTH = 1.0         # Сила видео эффекта
```

### web_interface.py - Параметры Flask

```python
API_SERVER = os.getenv('API_SERVER', 'http://127.0.0.1:8000')
UPLOAD_FOLDER = './web_uploads'
MAX_CONTENT_LENGTH = 2 * 1024 * 1024 * 1024  # 2 GB
```

---

## 📊 Процесс обработки видео

### Шаги пользователя:

1. **Загрузка видео** (2 мин)
   - Перетащить видео на страницу
   - Выбрать параметры обработки
   - Нажать "Начать обработку"
   - Видно прогресс загрузки (0-100%)

2. **Ожидание в очереди** (зависит от нагрузки)
   - Статус: "⏳ ОЖИДАНИЕ"
   - Видно место в очереди
   - Можно отменить

3. **Обработка видео** (5-30 мин, зависит от видео)
   - Статус: "⚙️ ОБРАБОТКА"
   - Видно прогресс кадров (X/Y)
   - Проценты заполнены
   - Реальные логи в консоли
   - Нельзя отменить после начала

4. **Скачивание** (10-30 сек)
   - Статус: "✅ ЗАВЕРШЕНО"
   - Кнопка "Скачать видео" активна
   - Скачивается обработанное видео

### Информация в консоли:

```
[12:34:56] ✨ Интерфейс загружен
[12:34:57] 📁 Файл выбран: video.mp4 (1.2 GB)
[12:34:58] 🚀 Начало загрузки видео...
[12:35:02] ✅ Видео загружено! ID: a1b2c3d4-...
[12:35:03] ⏳ Видео добавлено в очередь обработки...
[12:35:05] ⚙️ Обработка началась
[12:35:15] 📊 Обрабатывается: 100 / 1200 кадров
[12:35:45] 📊 Обрабатывается: 300 / 1200 кадров
...
[12:38:30] 🎉 Видео готово к скачиванию!
[12:38:35] ✅ Видео скачано!
```

---

## ⚙️ Параметры обработки

### Epsilon (сила возмущения)
- **Диапазон:** 0.04 - 0.20
- **По умолчанию:** 0.12
- **Описание:** Чем выше, тем сильнее шум-возмущение, но может повлиять на качество
- **Рекомендация:** 
  - 0.04 - 0.06: Минимальная защита, видно незначительные артефакты
  - 0.12 - 0.15: Оптимальный баланс (по умолчанию)
  - 0.18 - 0.20: Максимальная защита, может быть заметно

### Уровень защиты аудио
- **Варианты:** Отключено | Слабый | Средний | Сильный
- **По умолчанию:** Слабый
- **Описание:** Добавляет защиту к аудиотреку видео
- **Рекомендация:** Слабый/Средний для музыки, Сильный для критичных видео

### Кадры (каждый N-й кадр)
- **Диапазон:** 1 - 30
- **По умолчанию:** 10
- **Описание:** Обрабатывает каждый N-й кадр (экономит время и видеопамять)
- **Рекомендация:**
  - 1: Обрабатывать каждый кадр (самое медленно, лучшее качество)
  - 5-10: Хороший баланс (быстро + качество)
  - 20-30: Очень быстро, но качество может пострадать

### Сила видео эффекта
- **Диапазон:** 1.0 - 2.0
- **По умолчанию:** 1.0
- **Описание:** Множитель силы видео эффекта
- **Рекомендация:** 1.0 для стандартного, 1.5-2.0 для максимальной защиты

---

## 🐛 Решение проблем

### Сервер offline
- Убедитесь, что API сервер запущен на порте 8000
- Проверьте в терминале: `python run_server.py`
- Откройте http://127.0.0.1:8000/health

### Ошибка при загрузке видео
- Проверьте размер файла (макс 2GB)
- Проверьте формат (должно быть видео: mp4, avi, mov, mkv)
- Посмотрите логи консоли для деталей ошибки

### Обработка не начинается
- Проверьте свободное место на диске (нужно 3x размер видео)
- Проверьте доступность FFmpeg: `ffmpeg -version`
- Проверьте логи API сервера в терминале

### Консоль не показывает логи
- Откройте Developer Tools браузера (F12)
- Смотрите вкладку Console
- Проверьте Network запросы к `/api/task/<id>`

### Скачивание не работает
- Проверьте, что статус задачи "ЗАВЕРШЕНО"
- Отключите блокировщик всплывающих окон
- Попробуйте другой браузер

---

## 📈 Производительность

### Оптимизация для быстрой обработки

1. **Уменьшить разрешение видео:**
   - every_n_frames = 20 (обрабатывать каждый 20-й)
   - video_strength = 1.0 (минимальная сила)

2. **Использовать GPU:**
   - Убедитесь, что CUDA установлен
   - Проверьте: `python check_gpu.py`

3. **Параллельная обработка:**
   - API сервер автоматически обрабатывает несколько видео
   - Очередь управляется автоматически

### Примерные времена обработки:

| Видео          | Параметры                    | Время    |
|---|---|---|
| 1 min, 1080p   | epsilon=0.12, every_n=10     | 2-3 мин  |
| 10 min, 1080p  | epsilon=0.12, every_n=10     | 20-30 мин|
| 10 min, 1080p  | epsilon=0.12, every_n=20     | 10-15 мин|
| 10 min, 720p   | epsilon=0.12, every_n=10     | 15-20 мин|

---

## 🔐 Безопасность

### Приватность данных
- Все видео обрабатываются локально
- Файлы временно хранятся в `./web_uploads`
- После обработки файлы удаляются автоматически
- API требует валидных параметров

### HTTPS в production
Используйте Nginx как reverse proxy с SSL:

```nginx
server {
    listen 443 ssl;
    server_name your-domain.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://127.0.0.1:5000;
    }
    
    location /api {
        proxy_pass http://127.0.0.1:8000;
    }
}
```

---

## 📚 Интеграция с другими системами

### Embed на своем сайте

```html
<iframe src="http://your-server:5000" 
    width="100%" 
    height="800px" 
    frameborder="0">
</iframe>
```

### REST API запросы

```bash
# Загрузить видео
curl -X POST \
  -F "file=@video.mp4" \
  -F "epsilon=0.12" \
  -F "audio_level=слабый" \
  http://127.0.0.1:5000/upload

# Получить статус
curl http://127.0.0.1:5000/api/task/task-id-here

# Скачать видео
curl http://127.0.0.1:5000/api/download/task-id-here -o result.mp4
```

### Python интеграция

```python
import requests

# Загрузить видео
with open('video.mp4', 'rb') as f:
    response = requests.post(
        'http://127.0.0.1:5000/upload',
        files={'file': f},
        data={
            'epsilon': 0.12,
            'audio_level': 'слабый',
            'every_n_frames': 10,
        }
    )
    
task_id = response.json()['task_id']

# Проверить статус
response = requests.get(f'http://127.0.0.1:5000/api/task/{task_id}')
print(response.json())

# Скачать видео
response = requests.get(f'http://127.0.0.1:5000/api/download/{task_id}')
with open('result.mp4', 'wb') as f:
    f.write(response.content)
```

---

## 📞 Поддержка

При возникновении проблем:

1. Проверьте логи в консоли (обе программы)
2. Откройте Developer Tools браузера (F12)
3. Проверьте файл `server.log` для логов сервера
4. Убедитесь, что все зависимости установлены: `pip install -r requirements.txt`

---

## 🎓 Обучающие видео

Планируется: добавить ссылки на обучающие видео по использованию интерфейса

---

**Версия:** 2.2 (Web Interface)  
**Дата обновления:** Февраль 2024  
**Автор:** Media Cleaner Team
