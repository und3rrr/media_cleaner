═══════════════════════════════════════════════════════════════════════════════
📚 ИНДЕКС ДОКУМЕНТАЦИИ ДЛЯ РАЗВЕРТЫВАНИЯ НА ВЫДЕЛЁННОМ СЕРВЕРЕ
═══════════════════════════════════════════════════════════════════════════════

БЫСТРЫЙ СТАРТ (Начните отсюда!)
──────────────────────────────────────────────────────────────────────────────

📄 QUICK_DEPLOY_COMMANDS.md (Этот файл)
   ├─ Вариант 1: Автоматический скрипт (РЕКОМЕНДУЕТСЯ)
   ├─ Вариант 2: Пошаговые команды
   ├─ Вариант 3: Одна длинная команда
   └─ Вариант 4: Для опытных (тестирование без Nginx)
   
   ➤ ИСПОЛЬЗУЙТЕ ЭТОТ ФАЙЛ если вы хотите быстро развернуть


🚀 deploy.sh (АВТОМАТИЧЕСКИЙ СКРИПТ)
   └─ Полностью автоматизирует развертывание
   
   Использование:
   bash /home/media_cleaner/deploy.sh your-domain.com admin@email.com


════════════════════════════════════════════════════════════════════════════════
ПОЛНАЯ ДОКУМЕНТАЦИЯ ПО ЭТАПАМ
════════════════════════════════════════════════════════════════════════════════

📘 PRE_DEPLOYMENT_CHECKLIST.md
   ├─ Раздел 1: Подготовка домена и DNS
   ├─ Раздел 2: Требования к серверу (CPU, RAM, SSD, OS)
   ├─ Раздел 3: Выбор хостера и VPS параметры  
   ├─ Раздел 4: Подготовка к установке
   ├─ Раздел 5: Требования к файлам проекта
   ├─ Раздел 6: Требования к сетевой безопасности
   ├─ Раздел 7: Требования к бэкап и восстановлению
   ├─ Раздел 8: Требования к мониторингу и логам
   ├─ Раздел 9: Требования к SSL/TLS
   ├─ Раздел 10: Требования к Python окружению
   ├─ Раздел 11: Требования к production готовности
   ├─ Раздел 12: Контрольный список установки
   └─ Решение проблем и контактная информация
   
   ➤ ИСПОЛЬЗУЙТЕ ЭТОТ ФАЙЛ для подготовки перед началом


📗 SERVER_DEPLOYMENT_GUIDE.md
   ├─ ЧАСТЬ 1: Подготовка сервера (обновление, зависимости)
   ├─ ЧАСТЬ 2: Настройка приложения (виртуальное окружение, код)
   ├─ ЧАСТЬ 3: Создание systemd сервисов (FastAPI + Flask)
   ├─ ЧАСТЬ 4: Установка и конфигурация Nginx (reverse proxy)
   ├─ ЧАСТЬ 5: Получение SSL сертификата (Let's Encrypt)
   ├─ ЧАСТЬ 6: Настройка файрвола (UFW)
   ├─ ЧАСТЬ 7: Тестирование и верификация
   ├─ ЧАСТЬ 8: Оптимизация и мониторинг
   ├─ ЧАСТЬ 9: Команды для управления после установки
   ├─ ЧАСТЬ 10: Решение проблем
   └─ ФИНАЛЬНЫЕ ШАГИ и команды в одну строку
   
   ➤ ИСПОЛЬЗУЙТЕ ЭТОТ ФАЙЛ для пошагового развертывания


════════════════════════════════════════════════════════════════════════════════
СПРАВОЧНИКИ И КОМАНДЫ
════════════════════════════════════════════════════════════════════════════════

📗 SERVER_COMMANDS_REFERENCE.md
   ├─ Таблица портов и сервисов
   ├─ 🟢 Запуск и остановка сервисов
   ├─ 📊 Проверка статуса
   ├─ 📝 Просмотр логов
   ├─ 🔍 Отладка и диагностика
   ├─ 🔄 Обновление и переразвёртывание
   ├─ 🧹 Очистка и обслуживание
   ├─ 🔐 Безопасность и администрирование
   ├─ ⚠️ Решение проблем
   ├─ 📈 Мониторинг производительности
   └─ 🚀 Быстрые команды (копируй-вставляй)
   
   ➤ ИСПОЛЬЗУЙТЕ ЭТОТ ФАЙЛ как справочник после установки


════════════════════════════════════════════════════════════════════════════════
СЦЕНАРИИ ИСПОЛЬЗОВАНИЯ
════════════════════════════════════════════════════════════════════════════════

🎯 СЦЕНАРИЙ 1: Первое развертывание (полный процесс)
   1. Прочитайте: PRE_DEPLOYMENT_CHECKLIST.md
   2. Проверьте все требования
   3. Запустите: bash deploy.sh your-domain.com email@email.com
   4. Дождитесь завершения (5-15 минут)
   5. Проверьте: https://your-domain.com
   Время: ~15-20 минут


🎯 СЦЕНАРИЙ 2: Быстрое развертывание (опытные пользователи)
   1. Откройте: QUICK_DEPLOY_COMMANDS.md
   2. Выберите "Вариант 3" (одна строка)
   3. Скопируйте и вставьте команду
   4. Замените домен и email
   5. Выполните
   Время: ~10-15 минут


🎯 СЦЕНАРИЙ 3: Ручное развертывание (пошагово)
   1. Откройте: SERVER_DEPLOYMENT_GUIDE.md
   2. Выполняйте команды из каждого раздела
   3. Проверяйте статус между этапами
   4. При ошибках - смотрите раздел "Решение проблем"
   Время: ~30 минут (с проверками)


🎯 СЦЕНАРИЙ 4: Управление после развертывания
   1. Откройте: SERVER_COMMANDS_REFERENCE.md
   2. Найдите нужную категорию команд
   3. Скопируйте команду
   4. Выполните на сервере
   Частое использование: каждый день


🎯 СЦЕНАРИЙ 5: Отладка проблем
   1. SERVER_DEPLOYMENT_GUIDE.md "Раздел 10: Решение проблем"
   2. SERVER_COMMANDS_REFERENCE.md "⚠️ Решение проблем"
   3. PRE_DEPLOYMENT_CHECKLIST.md "Если что-то не получилось"
   4. Посмотрите логи: sudo journalctl -u media-cleaner-api -f
   Частое использование: при ошибках


════════════════════════════════════════════════════════════════════════════════
ТАБЛИЦА ПОРТОВ И СЕРВИСОВ
════════════════════════════════════════════════════════════════════════════════

Порт | Сервис              | Назначение                    | Видимость
─────────────────────────────────────────────────────────────────────────────
5000 | Flask (Gunicorn)    | Веб-интерфейс (UI)           | Только Nginx
8000 | FastAPI (Uvicorn)   | REST API для обработки видео | Только Nginx
80   | Nginx HTTP          | Редирект на HTTPS            | Публичный
443  | Nginx HTTPS         | Основной доступ к сайту      | Публичный
22   | SSH                 | Удалённое администрирование  | Публичный
────────────────────────────────────────────────────────────────────────────── 

ВАЖНО: Nginx работает как reverse proxy. Пользователи обращаются только к 
portам 80 и 443. Порты 5000 и 8000 открыты только локально для Nginx.


════════════════════════════════════════════════════════════════════════════════
ТАБЛИЦА ФАЙЛОВ И ОПИСАНИЕ
════════════════════════════════════════════════════════════════════════════════

Файл/Папка          | Описание
─────────────────────────────────────────────────────────────────────────────
media_cleaner.py    | Основная программа видео-обработки
server_app.py       | FastAPI сервер (REST API)
main.py             | Flask приложение (веб-интерфейс)
queue_processor.py  | Обработчик очереди задач обработки
config.json         | Конфигурационный файл (нужно обновить пути!)
requirements.txt    | Зависимости Python (для pip install)
templates/          | HTML шаблоны (index.html)
static/             | Статические файлы (CSS, JS, изображения)
ffmpeg/             | Папка с FFmpeg бинарником (опционально)
─────────────────────────────────────────────────────────────────────────────
uploads/            | Загруженные видео (создаётся автоматически)
logs/               | Логи приложения (создаются автоматически)
temp/               | Временные файлы обработки (очищается автоматически)
backups/            | Резервные копии (создаются вручную или по cron)
venv/               | Python виртуальное окружение


════════════════════════════════════════════════════════════════════════════════
СТРУКТУРА КАТАЛОГОВ НА СЕРВЕРЕ (ПОСЛЕ УСТАНОВКИ)
════════════════════════════════════════════════════════════════════════════════

/home/media_cleaner/
├── config.json                 # Конфигурация (обновлена для Linux)
├── requirements.txt            # Зависимости Python
├── media_cleaner.py            # Основной код
├── server_app.py               # FastAPI
├── main.py                     # Flask
├── queue_processor.py          # Очередь задач
├── templates/                  # HTML файлы
│   └── index.html             # Главная страница
├── static/                     # Статические файлы
│   ├── script.js              # JavaScript (с исправлением утечки памяти!)
│   ├── style.css              # Стили
│   └── ...
├── venv/                       # Виртуальное окружение Python
│   ├── bin/                   # Исполняемые файлы (python, pip, gunicorn, uvicorn)
│   ├── lib/                   # Установленные пакеты
│   └── ...
├── uploads/                    # Загруженные видео (для обработки)
├── logs/                       # Логи приложения
│   ├── gunicorn_access.log    # Логи Flask веб-сервера
│   ├── gunicorn_error.log     # Ошибки Flask
│   └── ...
├── temp/                       # Временные файлы при обработке
├── backups/                    # Резервные копии
└── deploy.sh                   # Скрипт развертывания


════════════════════════════════════════════════════════════════════════════════
СИСТЕМНЫЕ КОНФИГИ (ПОСЛЕ УСТАНОВКИ)
════════════════════════════════════════════════════════════════════════════════

Systemd сервисы:
├── /etc/systemd/system/media-cleaner-api.service    # FastAPI сервис
├── /etc/systemd/system/media-cleaner-web.service    # Flask сервис
└── Управление: sudo systemctl {start|stop|restart|status} media-cleaner-*

Nginx:
├── /etc/nginx/sites-available/media-cleaner         # Конфиг  
├── /etc/nginx/sites-enabled/media-cleaner           # Включённый конфиг (ссылка)
└── Логи: /var/log/nginx/media-cleaner-{access|error}.log

SSL сертификаты:
├── /etc/letsencrypt/live/YOUR_DOMAIN/fullchain.pem # Сертификат
└── /etc/letsencrypt/live/YOUR_DOMAIN/privkey.pem   # Приватный ключ


════════════════════════════════════════════════════════════════════════════════
ПРОВЕРОЧНЫЕ КОМАНДЫ ПОСЛЕ УСТАНОВКИ
════════════════════════════════════════════════════════════════════════════════

Проверьте что всё работает:

1. Сервисы запущены:
   sudo systemctl status media-cleaner-api media-cleaner-web nginx

2. Порты открыты:
   sudo ss -tupln | grep -E '5000|8000|80|443'

3. Веб-интерфейс доступен (в браузере):
   https://your-domain.com

4. API документация (в браузере):
   https://your-domain.com/api/docs   (если через Nginx)

5. Логи работают:
   sudo journalctl -u media-cleaner-api -n 10

6. Нет ошибок:
   sudo journalctl -u media-cleaner-api -p err
   sudo journalctl -u media-cleaner-web -p err


════════════════════════════════════════════════════════════════════════════════
ОСНОВНЫЕ КОМАНДЫ ДЛЯ УПРАВЛЕНИЯ
════════════════════════════════════════════════════════════════════════════════

# Запустить/остановить/перезагрузить приложение:
sudo systemctl {start|stop|restart} media-cleaner-api media-cleaner-web

# Посмотреть логи в реал-тайме:
sudo journalctl -u media-cleaner-api -f
sudo tail -f /var/log/nginx/media-cleaner-error.log

# Обновить код (если используете git):
cd /home/media_cleaner && git pull && sudo systemctl restart media-cleaner-api

# Перезагрузить Nginx конфиг (без перезагрузки):
sudo systemctl reload nginx

# Посмотреть память/CPU использование:
ps aux | grep media_cleaner

# Полная диагностика:
sudo systemctl is-active media-cleaner-api media-cleaner-web nginx

Для полного списка смотрите: SERVER_COMMANDS_REFERENCE.md


════════════════════════════════════════════════════════════════════════════════
РЕШЕНИЕ ТИПИЧНЫХ ПРОБЛЕМ
════════════════════════════════════════════════════════════════════════════════

❌ Ошибка при установке PyTorch → Используйте pip без --no-cache-dir
❌ Port already in use → Используйте другой порт или остановите конфликтующий сервис
❌ 502 Bad Gateway → Проверьте что API запущен (systemctl status media-cleaner-api)
❌ SSL ошибка → Убедитесь что DNS правильно настроен и домен разрешается
❌ Высокое использование памяти → Уменьшите workers или добавьте RAM

Для полного списка смотрите: PRE_DEPLOYMENT_CHECKLIST.md или SERVER_DEPLOYMENT_GUIDE.md


════════════════════════════════════════════════════════════════════════════════
РЕКОМЕНДУЕМЫЙ ПОТОК ДЕЙСТВИЙ
════════════════════════════════════════════════════════════════════════════════

1️⃣ ПЕРЕД НАЧАЛОМ (5 минут):
   → Прочитайте PRE_DEPLOYMENT_CHECKLIST.md
   → Заполните все требования
   → Проверьте что DNS настроен

2️⃣ РАЗВЕРТЫВАНИЕ (15 минут):
   → Выберите один из вариантов в QUICK_DEPLOY_COMMANDS.md
   → Запустите скрипт/команды
   → Дождитесь завершения

3️⃣ ПРОВЕРКА (5 минут):
   → Откройте https://your-domain.com
   → Загрузите тестовое видео
   → Проверьте что обработка работает
   → Посмотрите логи на ошибки

4️⃣ ОПТИМИЗАЦИЯ (10 минут):
   → Увеличьте workers если надо
   → Настройте мониторинг
   → Установите бэкап
   → Документируйте конфигурацию

5️⃣ ОПЕРАЦИОННАЯ ДЕЯТЕЛЬНОСТЬ (ежедневно):
   → Используйте SERVER_COMMANDS_REFERENCE.md для управления
   → Проверяйте логи регулярно
   → Следите за памятью и диском
   → Создавайте бэкапы


════════════════════════════════════════════════════════════════════════════════
ССЫЛКИ НА ДОКУМЕНТАЦИЮ
════════════════════════════════════════════════════════════════════════════════

📚 Основная документация:
   → README.md          — Общее описание проекта
   → ARCHITECTURE.md    — Архитектура приложения
   → INSTALLATION.md    — Локальная установка на Windows

🚀 Развертывание на сервере:
   → QUICK_DEPLOY_COMMANDS.md        ← НАЧНИТЕ ОТСЮДА
   → deploy.sh                        (автоматический скрипт)
   → PRE_DEPLOYMENT_CHECKLIST.md      (требования и помощь)
   → SERVER_DEPLOYMENT_GUIDE.md       (пошаговое руководство)
   → SERVER_COMMANDS_REFERENCE.md     (справочник команд)

⚙️ Дополнительно:
   → MEMORY_LEAK_FIX_REPORT.md  — Исправление утечки памяти в браузере
   → CONFIG примеры в config.json
   → CHANGELOG.md  — Истории изменений


════════════════════════════════════════════════════════════════════════════════
ГДЕ ПОЛУЧИТЬ ПОМОЩЬ
════════════════════════════════════════════════════════════════════════════════

1. Ошибка при установке:
   → Посмотрите "Решение проблем" в PRE_DEPLOYMENT_CHECKLIST.md
   → Проверьте логи: sudo journalctl -u media-cleaner-api -n 50

2. Вопросы о командах:
   → Смотрите SERVER_COMMANDS_REFERENCE.md

3. Что-то не работает после установки:
   → Проверьте SERVER_DEPLOYMENT_GUIDE.md "ЧАСТЬ 10: Решение проблем"
   → Посмотрите Nginx логи: sudo tail -f /var/log/nginx/media-cleaner-error.log

4. Нужна информация о версиях:
   → Команды проверки версий в QUICK_DEPLOY_COMMANDS.md

5. Чеклист перед запуском:
   → Используйте PRE_DEPLOYMENT_CHECKLIST.md


════════════════════════════════════════════════════════════════════════════════
✅ ИТОГО: ПОЛНЫЙ ПАКЕТ ДЛЯ РАЗВЕРТЫВАНИЯ ГОТОВ!

Вас ждёт:
✓ Пошаговое руководство (SERVER_DEPLOYMENT_GUIDE.md)
✓ Автоматический скрипт (deploy.sh)
✓ Быстрые команды (QUICK_DEPLOY_COMMANDS.md)
✓ Справочник команд (SERVER_COMMANDS_REFERENCE.md)
✓ Чек-лист подготовки (PRE_DEPLOYMENT_CHECKLIST.md)

Начните с: QUICK_DEPLOY_COMMANDS.md или PRE_DEPLOYMENT_CHECKLIST.md

Успехов с развертыванием! 🚀

════════════════════════════════════════════════════════════════════════════════
