# BUG FIX REPORT: Audio Extraction Error

## Проблема
При обработке видео возникала ошибка при извлечении аудио:
```
2026-02-11 14:42:03,847 - ERROR - Ошибка извextraction аудио: [WinError 2] Не удается найти указанный файл
FileNotFoundError: [WinError 2] Не удается найти указанный файл
```

Видео успешно обрабатывалось (667 кадров с шумом), но при склейке видеоряда и звука программа не могла найти временные аудио-файлы.

## Корневая причина
Проблема заключалась в использовании **относительных путей** для временных аудио-файлов:

### Было (неправильно):
```python
def process_imperceptible_protected_video(input_path: str) -> bool:
    base = Path(input_path).stem
    temp_audio_orig = f"{base}_audio_orig.wav"  # ❌ Относительный путь
    temp_audio_adv = f"{base}_audio_adv.wav"    # ❌ Относительный путь
```

**Проблема:** Когда видео находилось в полном пути, например:
- `C:\Users\User\Desktop\!\media_cleaner\IMG_1035.MP4`

Файлы `IMG_1035_audio_orig.wav` и `IMG_1035_audio_adv.wav` создавались в **текущей рабочей директории**, а не в папке с видео. Это приводило к тому, что функции не могли найти эти файлы.

## Решение
Изменены все функции для использования **абсолютных путей**, построенных на основе директории входного видеофайла:

### Исправлено (правильно):
```python
def process_imperceptible_protected_video(input_path: str) -> bool:
    base = Path(input_path).stem
    input_dir = Path(input_path).parent  # ✓ Получаем директорию видео
    temp_audio_orig = str(input_dir / f"{base}_audio_orig.wav")  # ✓ Полный путь
    temp_audio_adv = str(input_dir / f"{base}_audio_adv.wav")    # ✓ Полный путь
```

## Измененные файлы

### 1. `media_cleaner.py`

#### Изменение 1: `process_imperceptible_protected_video()` (строки 880-892)
- Теперь создает временные аудио-файлы в той же директории, что и входное видео
- Использует полный путь через `input_dir / filename`

#### Изменение 2: `VideoProcessor.process_video()` (строки 380-388)
- Теперь создает папку с кадрами в той же директории, что и входное видео
- Использует объект `Path` для работы с путями

#### Изменение 3: `list_video_files()` (строки 595-603)
- Теперь возвращает **абсолютные пути** к видео-файлам, используя `.resolve()`
- Это гарантирует, что все последующие операции будут работать с полными путями

### 2. `examples.py`

Обновлены все примеры использования для согласованности с основной программой:
- Добавлены получение `input_dir = Path(input_video).parent.resolve()`
- Изменены все временные пути на полные: `str(input_dir / filename)`

## Результат

После этих изменений:
- ✓ Временные аудио-файлы создаются в правильной директории
- ✓ FFmpeg правильно находит файлы при извлечении и обработке аудио
- ✓ Склейка видеоряда и звука работает без ошибок
- ✓ Программа работает независимо от текущей рабочей директории

## Тестирование
Для проверки исправления:
1. Запустите программу с видео, находящимся в другой директории
2. Убедитесь, что обработка завершается успешно без ошибки `FileNotFoundError`
3. Проверьте, что временные файлы создаются в папке с исходным видео
